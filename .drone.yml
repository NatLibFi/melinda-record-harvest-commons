---
kind: pipeline
type: docker
name: Default

trigger:
  event:
    - push
    - tag

steps:

  - name: audit
    image: node:12
    commands:
      - npm audit --package-lock-only --production --audit-level=moderate

  - name: install
    image: node:12
    environment:
      NPM_CONFIG_IGNORE_SCRIPTS: true      
    commands:
      - npm ci

  #- name: test
  #  image: node:12
  #  commands:
  #    - npm test

  #- name: check-coverage
  #  image: node:12
  #  commands:
  #    - npm run coverage

  - name: build
    image: node:12
    commands:
      - npm run build
      - NPM_CONFIG_IGNORE_SCRIPTS=true npm ci --production

  - name: static-security-scan
    image: quay.io/natlibfi/njsscan
    commands:
      - njsscan dist

  - name: npm
    image: plugins/npm
    settings:
      registry: 'https://registry.npmjs.org/'
      token:
        from_secret: npm_token
    when:
      event: tag 
---
kind: pipeline
type: docker
name: Update dependencies

trigger:
  event:
    - custom
  branch:
    - master

steps:

  - name: publish
    image: quay.io/natlibfi/drone-npm-git-publish
    settings:
      git_user_name: natlibfi-melinda-automation
      git_user_email: 65649125+natlibfi-melinda-automation@users.noreply.github.com
      git_ssh_key:
        from_secret: ssh_key
      git_gpg_key:
        from_secret: gpg_key
---
kind: secret
name: npm_token
data: YeVDhT6umsoTr7gaCPDbWmYmUmOCoMBEiEHiNICGtoXNoqlICiC078tB9uErwtj8u66qdg6Z46+Z+ijxqJBR+Q==
---
kind: secret
name: ssh_key
data: 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
---
kind: secret
name: gpg_key
data: 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
---
kind: signature
hmac: a2ba107c88adfdd05469ce73776892cf94863de148b0ad926d141c1235bde626

...
