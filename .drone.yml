---
kind: pipeline
type: docker
name: Default

trigger:
  event:
    - push
    - tag

steps:

  - name: audit
    image: node:12
    commands:
      - npm audit --package-lock-only --production --audit-level=moderate

  - name: install
    image: node:12
    environment:
      NPM_CONFIG_IGNORE_SCRIPTS: true      
    commands:
      - npm ci

  - name: test
    image: node:12
    commands:
      - npm test

  - name: check-coverage
    image: node:12
    commands:
      - npm run coverage

  - name: build
    image: node:12
    commands:
      - npm run build
      - npm ci --production

  - name: static-security-scan
    image: quay.io/natlibfi/nodejsscan
    commands:
      - python /usr/src/app/cli.py -d dist

  - name: npm
    image: plugins/npm
    settings:
      registry: 'https://registry.npmjs.org/'
      token:
        from_secret: npm_token
    when:
      event: tag 
---
kind: pipeline
type: docker
name: Update dependencies

trigger:
  event:
    - custom
  branch:
    - master

steps:

  - name: publish
    image: quay.io/natlibfi/drone-npm-git-publish
    settings:
      git_user_name: natlibfi-melinda-automation
      git_user_email: 65649125+natlibfi-melinda-automation@users.noreply.github.com
      git_ssh_key:
        from_secret: ssh_key
      git_gpg_key:
        from_secret: gpg_key
---
kind: secret
name: npm_token
data: pgkxKUuPgdYiH8gzM6TCcxRiCIx2WTwZ/ywi2JTfTjdrNHBncsjTGsA9pPUmVYMhSqybY9VpHj3+u9kPBdRtpQ==
---
kind: secret
name: ssh_key
data: QrIbuehYnjpP4hy+lfAwLkm/hOrpMHZkdNW9a8ZBmks0wT/c3Ka/lRmS+nvERTXNveVWtrP1BhhtJ/fFpa7rJhMB45T/o+FkEdMQRF71nR4GLRlj2wH6v8y2Sm48BFslR3rWx7WFLN0WwNAuKGA13NTv6TLufVWwyWhH+vDrjH3q1HfuHeT3Z7fyqQDJdSonEFOdHHC8mlC6Z9dfj8566soJ3OAmx7MJKWIzqylV15qIfBFyYo63BjNWTku8izRTHCZCiWZ+9I9YBx9msRPwV3rq35AOxtbxlOJOV80o+QKuao3pno1M9YO9Emjb5uAazsEgzeUsKcDLRKGU2nyoYxSeoZT6KEHqn4pfQwH8h75G7iURHTSrxp0B8T2XL+k3slCuXxTXz4BASLFap9JsOy7GB2zPVciKIr5uaOspEtgWqGRiFLTp8I8ghA9xI2T3W3rcA9Z/j691eXaAl7O+UVTWOwrxI1I0pUUNP3Qy5eShpnaUST+9a+ESTbyBD+ENBfPYDxR9J1jlK7bMriOshE9AWJflbPRtozmxtA+ybcP8UY7yA/p7HjWuqjQvzTutnhLFQGVUmGFJ5QXbdc8k35rtv6rwcGR6uFVtovregkETw/vUt0IFsdn7OVFDsWBjes7cG0x5FTayXv6Yn843B3B8tf+YYnl6ZwpImA196bpGdHDaAJGXQoXCnhxonKyYUb8NPN74vDDImVmgxYyNDWsSUB9bF7xWUOjUouoUgo8kt4o/r7VzmtqoFMzmsJ3fCwVYCvXRp5FLYznF263YmwEQy4ftOp+y31fH6HiVLgCT/yEccnqieBmZNddQD9wLZXI4jj2mBNnqhCQTTTjBmww5qZ1bZGtad9r70N4fK5HpmVYJOfVBKwHEJw908nCsQVuvi0wNFOpzTQZgIHaQsSvTLJJH7UKQjESCz3gCSNuyTtN67HpNw7I6GtBdGAonHLDimvetTRPiQSRmAWvItITVL/E4wq+rI1MHsehKAKYIGDFZYW7hNSk9Le8YgO/EjrzAvaeOqYcfdwfe2HgO/5oIO+DiOrIv+l0yytOkTC3ZTD1V2qrSQR08X1Wpdsnx51/SlvSb/08R9zBuVDKhBgqU6iTRkiZJ2ALTOupYT196wy0TnOiZIc9kSvEEhXdepvWC4wRUtpDFa9/HYVGStew3/qKc9IqKiK4Oam0wNTdusHQEzDijbEfWomyGGiEa9ESGVpZbIMTuXfj63NIYRZFjcfN7x/+shDcf/FU1LzWtd9PgYCA9N7NQagEsGdVmjf9JIQCNFHxKdR5hW6Hlbt0yW/Lyw+PBrH+OiAKYjk1ypN1UT9e2VFiFJ7Owhh3B+410tm4jW+ttNQOxifDCq2it6bxBPqjbF8DwqJ6w6utg3akZTBr04NLZKCOtYJLEdivgZiReBPyXGvj4QJYsQV9YB5r6ywd5DLlaHUUBl7ny+5TRGloL0VgjDpi7dWAZTcjlQPPmN1QMH4nno5/Ks061CWGw5C5EL8HYKmQHtucn71qMiFn0a7N0yHvBf5Qb3CrNROylYVjQDBoKFuT0fu39W7O/tooOhKNbWfoRMXtu70TPqK3TYTa+hCHIUc0hwy9h24VYPkYRzwuvb/rQwUM8Md/McWF/8+x9GP57Gp7L6JgiEDi8n9nYFZi/yxg/htq5LSo0iZqYuKTelbiYMbv5m2Nf+cah8AmJ8/Be0p3XYdr8pJ2PyW6SXp+IAcZcwA+Dk5e1wrq4bBhoS4gm/PcXdalJWonzy5s01GA/jBZw2YgS03hx1InYqFtcW9fG2ki296AT3NAKW94S1JIdD7nWJZvIo/dJc9L+E+5kPn4+2capGA913Y9BDFXUYctnMo6qCGu92y0o3nJ9bdRH+0fzUmVLmzzbqS4BlkJcbfo+f/85DvslzYp4hWrIZtK0qut1pmmEsXrF2lNOiWlOh4snxylonTngrHbmmy6BBk4463G2juRAEwwjroawpLy9/nb/6r1wIoX9M/56AgrlpV4yC+CsvQcs3DOczybo4r7AMCUODpYe34kJ3ZyVTaV+jKw1rHCMla719pTMMy9komKo9dotG13hSG2J5rZ5chffw0ZNu3YMKc+J77DFdtrdwDv6W591zn4q0kmWa5JytWLWbqxPfswHkco2QZpv35MVM9mDjc/6VdCmpmRYw5IhVLxjsV+WoGrQih/Zm53izz/ElszRb2kgUMWyJO9UwFywGS1u+Vmo4ZkFqZdO4iJQzPD67TGYFOCc468K0iBUcpHg726LoAymKLMUSY1q+tiweE9SKwGJI+GbNAN/CANJ/+53dd8mEjTMQPrp3O+ynlkzpTnJqrx1Us6q8+jIf+72399KXBs0MGKxjgeiG7vBPVktpyORLXABGtYGFMPOZ1L5Xjc0haToHmfcTdvP5eGvHsFNC+jPCHZ7LgqOV+EW+AylihagnNXnp9UTYiEFyrT9VO3NDUNNEX9BwrAQXWVtXO03dq2059mZwG+nj1X6j2sWzaCB2091nkItie0djgncr0nF1ut7MNkQyKy1kAFEFIxJjM2FoU69zos7XfowXMjXIynsldgeQSfWvu+2QMmoo0VIDoM+AjGhkWJAraKc5//mesft/Jh1ywkoSY+bb/K4ZWShb3lAHn4B3tS8KhAsGz1Z3Ym5vNFNaBZ3j6JASMNJ2EmfOFotCJpuGux08j099TA8Kp4CrDSh/RQgVNyKiwbjqOygpdkTSJ1Cl/oR2x6NErk61ltUSS0uj3FVpjk7uEG1RidWjH5rvuLQ9BWxZ/yezr32O+D8iiz8V4HkmkjGjdn7KEnb4f+UND5Zeh8sPnjHwFSAwJCdq2sg0fQnqT3LqjRZKo06BcWEqVorxU6+1Uy4pyMkk6Z741Ym2qp+KRoqJ4oXJsYbCTchMpF8rIZl5UkW2fq+216v14oRottS4lv7DhgbmNOaarOI8OzTt/wmdq/zjv01PVtT09kGDz8musCFsqq1MVXfE5hXP4d5uav7M38Hcb48kd9QwgINTuljq9U/O66S
---
kind: secret
name: gpg_key
data: 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
---
kind: signature
hmac: 5f92b45a09a0feb5e9b4c651a2ac34b568da896c0e952011f770808e961b1484

...
